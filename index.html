<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„ØºØ±Ø§Ù‚Ø© Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f0f2f5;padding:20px;direction:rtl;}
h1,h2,h3,h4{text-align:center;margin:10px;}
.group{padding:15px;margin-bottom:25px;border-radius:12px;color:#fff;box-shadow:0 4px 10px rgba(0,0,0,0.15);}
.group.A{background:linear-gradient(45deg,#4a90e2,#357abd);}
.group.B{background:linear-gradient(45deg,#27ae60,#1e8449);}
.group.E{background:linear-gradient(45deg,#f39c12,#d68910);}
.group.F{background:linear-gradient(45deg,#c0392b,#922b21);}
table{width:100%;border-collapse:collapse;margin-top:10px;background:#fff;color:#000;border-radius:8px;overflow:hidden;}
th,td{border:1px solid #ddd;padding:8px;text-align:center;}
button{padding:4px 8px;margin:2px;cursor:pointer;border-radius:6px;border:none;background:#333;color:#fff;}
input,select{padding:4px;margin-left:4px;}
.team-editable{cursor:pointer;font-weight:bold;}
#scorersTable {width:100%;border-collapse:collapse;margin-top:15px;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.2);}
#scorersTable th{background:linear-gradient(90deg,#f39c12,#f1c40f);color:#fff;padding:12px;font-size:16px;}
#scorersTable td{padding:10px;text-align:center;border-bottom:1px solid #ddd;font-size:15px;transition:background 0.3s;}
#scorersTable tbody tr:nth-child(even){background:#f9f9f9;}
#scorersTable tbody tr:nth-child(odd){background:#fff;}
#scorersTable tbody tr:hover{background:#ffeaa7;cursor:default;}
</style>
</head>
<body>
<h1>ğŸ† Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„ØºØ±Ø§Ù‚Ø© Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ©</h1>
<div id="mainPanel"></div>

<div id="topScorers">
<h2>ØªØ±ØªÙŠØ¨ Ø§Ù„Ù‡Ø¯Ø§ÙÙŠÙ†</h2>
<table id="scorersTable">
<thead><tr><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ø§Ù„ÙØ±ÙŠÙ‚</th><th>Ø£Ù‡Ø¯Ø§Ù</th><th id="actionsHeader"></th></tr></thead>
<tbody></tbody>
</table>
<div id="addScorerDiv" style="text-align:center;"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, onValue, push, set, get, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "gharaqa-ramadan.firebaseapp.com",
  databaseURL: "https://gharaqa-ramadan-default-rtdb.firebaseio.com",
  projectId: "gharaqa-ramadan"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const MASTER_PASSWORD = "7890";

const defaultGroups = {
  A:["Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¹Ø¨Ø¯Ø§Ù„ÙˆÙ‡Ø§Ø¨","Ø´Ø¨Ø§Ø¨ Ø§Ù„Ø´ÙˆÙƒØ©","Ù…Ø­Ù„Ø© ÙƒÙŠÙ„","Ø£ØµØ¯Ù‚Ø§Ø¡ Ø­ÙˆØ´ Ø¹ÙŠØ³ÙŠ","Ø´Ø¨Ø§Ø¨ ÙƒÙˆÙ… Ø§Ù„Ø¨ÙˆØµ","Ø§Ù„ØºØ±Ø§Ù‚Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©"],
  B:["Ø§Ù„Ø´ÙˆÙƒØ© Ø§Ù„Ø­Ø§Ø¬Ø±","Ø§Ù„Ø±ÙŠÙ Ø§Ù„Ù…ØµØ±ÙŠ","Ø§Ù„ØµÙˆØ§Ù„Ø­ÙŠØ©","Ø§ØµØ¯Ù‚Ø§Ø¡ Ù…Ø­Ù…Ø¯ ÙØ¤Ø§Ø¯","Ø§Ù„Ø²Ù…Ø§Ù„ÙƒØ§ÙˆÙŠØ©","Ø§Ù„Ø¨Ø±Ù†ÙˆØ¬ÙŠ"],
  E:["Ù…Ù…ØªØ§Ø²","ÙƒÙˆÙ… Ø§Ù„Ø¨ÙˆØµ","Ù†Ø¬Ø¹ Ø§Ù„Ø¹Ø²Ø§ÙŠÙ…","Ø´Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ø³Ø§ÙƒØ±Ø©","Ø£Ù†ØµØ§Ù","Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ø³Ø§Ù…Ù‡ Ø§Ù„Ø¬Ø§Ø±Ø­ÙŠ"],
  F:["Ù†Ø¬ÙˆÙ… Ø¨Ø·ÙˆØ±Ø³","Ø§Ù„Ø¯ÙŠØ§Ø¨Ø©","ÙƒÙˆÙ… Ø§Ù„Ù‚Ù†Ø§Ø·Ø±","ÙÙ„Ø³Ø·ÙŠÙ†","Ø§Ù„Ø­Ø±ÙŠÙØ©","Ø§Ù„ØºØ±Ø§Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©"]
};

let groups = { A:[], B:[], E:[], F:[] };
let isMaster = false;
if(location.search.includes("master")){
  const pw = prompt("Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø§Ø³ØªØ±");
  if(pw===MASTER_PASSWORD) isMaster = true;
}

const mainDiv = document.getElementById("mainPanel");
const addScorerDiv = document.getElementById("addScorerDiv");
const actionsHeader = document.getElementById("actionsHeader");

// Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
for(const g of ["A","B","E","F"]){
  get(ref(db,"teams/"+g)).then(snap=>{
    if(!snap.exists() || !Array.isArray(snap.val()) || snap.val().length===0){
      set(ref(db,"teams/"+g), defaultGroups[g]);
    }
  });
}

for(const g of ["A","B","E","F"]){
  const div = document.createElement("div");
  div.className = "group "+g;

  let html = `<h3>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${g}${isMaster?" (ØªØ­ÙƒÙ…)":""}</h3>
  <table id="table-${g}">
    <thead><tr>
      <th>Ø§Ù„ÙØ±ÙŠÙ‚</th><th>Ù„Ø¹Ø¨</th><th>ÙÙˆØ²</th><th>ØªØ¹Ø§Ø¯Ù„</th><th>Ø®Ø³Ø§Ø±Ø©</th>
      <th>+</th><th>-</th><th>ÙØ§Ø±Ù‚</th><th>Ù†Ù‚Ø§Ø·</th>
    </tr></thead>
    <tbody></tbody>
  </table>
  <h4>Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h4>
  <table id="matches-${g}">
    <thead><tr>
      <th>ÙØ±ÙŠÙ‚</th><th>Ø£Ù‡Ø¯Ø§Ù</th><th>ÙØ±ÙŠÙ‚</th><th>Ø£Ù‡Ø¯Ø§Ù</th>${isMaster?'<th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th>':""}
    </tr></thead>
    <tbody></tbody>
  </table>`;

  if(isMaster){
    html += `
    <div>
      <button onclick="addTeam('${g}')">Ø¥Ø¶Ø§ÙØ© ÙØ±ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯</button>
    </div>
    <div>
      <select id="t1-${g}"></select>
      <input type="number" id="s1-${g}" value="0"> -
      <input type="number" id="s2-${g}" value="0">
      <select id="t2-${g}"></select>
      <button onclick="addMatch('${g}')">Ø¥Ø¶Ø§ÙØ© Ù†ØªÙŠØ¬Ø©</button>
    </div>`;
  }

  div.innerHTML = html;
  mainDiv.appendChild(div);

  onValue(ref(db,"teams/"+g), snap=>{
    const val = snap.val();
    if(val && Array.isArray(val)) groups[g] = val;
    fillSelects(g);
    listenGroup(g);
    if(isMaster) updateScorerForm();
  });
}

function fillSelects(g){
  const t1Sel = document.getElementById(`t1-${g}`);
  const t2Sel = document.getElementById(`t2-${g}`);
  if(!t1Sel) return;
  t1Sel.innerHTML=""; t2Sel.innerHTML="";
  groups[g].forEach(t=>{
    t1Sel.add(new Option(t,t));
    t2Sel.add(new Option(t,t));
  });
}

window.inlineRename = async function(g, oldName){
  if(!isMaster) return;
  const newName = prompt("Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„ÙØ±ÙŠÙ‚:", oldName);
  if(!newName || newName.trim()==="" || newName===oldName) return;

  await deleteTeamInline(g, oldName);
  groups[g].push(newName);
  await set(ref(db,"teams/"+g), groups[g]);
}

window.deleteTeamInline = async function(g, team){
  if(!isMaster) return;
  if(!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙØ±ÙŠÙ‚ "${team}"ØŸ`)) return;

  groups[g] = groups[g].filter(t=>t!==team);
  await set(ref(db,"teams/"+g), groups[g]);

  const snap = await get(ref(db,"matches/"+g));
  const data = snap.val() || {};
  for(const k in data){
    const m = data[k];
    if(m.t1===team || m.t2===team) await set(ref(db,"matches/"+g+"/"+k), null);
  }
}

window.addTeam = async function(g){
  const name = prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
  if(!name || name.trim()==="") return;
  groups[g].push(name);
  await set(ref(db,"teams/"+g), groups[g]);
}

window.addMatch = function(g){
  const t1 = document.getElementById(`t1-${g}`).value;
  const t2 = document.getElementById(`t2-${g}`).value;
  const s1 = parseInt(document.getElementById(`s1-${g}`).value)||0;
  const s2 = parseInt(document.getElementById(`s2-${g}`).value)||0;
  if(t1===t2) return alert("Ø§Ø®ØªØ§Ø± ÙØ±ÙŠÙ‚ÙŠÙ† Ù…Ø®ØªÙ„ÙÙŠÙ†");
  push(ref(db,"matches/"+g),{t1,t2,s1,s2,time:Date.now()});
}

window.editMatch = function(g,k){
  const s1 = prompt("Ù‡Ø¯Ù Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„");
  const s2 = prompt("Ù‡Ø¯Ù Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ");
  if(s1===null||s2===null) return;
  set(ref(db,"matches/"+g+"/"+k+"/s1"), parseInt(s1)||0);
  set(ref(db,"matches/"+g+"/"+k+"/s2"), parseInt(s2)||0);
  set(ref(db,"matches/"+g+"/"+k+"/time"), Date.now());
}

window.delMatch = function(g,k){
  if(confirm("Ø­Ø°ÙØŸ")) set(ref(db,"matches/"+g+"/"+k), null);
}

function listenGroup(g){
  onValue(ref(db,"matches/"+g), snap=>{
    const data = snap.val()||{};
    const teamsObj={};
    groups[g].forEach(t=>teamsObj[t]={name:t,p:0,w:0,d:0,l:0,gf:0,ga:0,gd:0,pts:0});

    for(const k in data){
      const m = data[k];
      const a = teamsObj[m.t1], b = teamsObj[m.t2];
      if(!a||!b) continue;
      a.p++; b.p++;
      a.gf+=m.s1; a.ga+=m.s2;
      b.gf+=m.s2; b.ga+=m.s1;
      if(m.s1>m.s2){a.w++;a.pts+=3;b.l++;}
      else if(m.s2>m.s1){b.w++;b.pts+=3;a.l++;}
      else{a.d++;b.d++;a.pts++;b.pts++;}
    }

    Object.values(teamsObj).forEach(x=>x.gd=x.gf-x.ga);
    const sorted = Object.values(teamsObj).sort((a,b)=>b.pts-a.pts || b.gd-a.gd || b.gf-a.gf);

    const table = document.querySelector(`#table-${g} tbody`);
    const matches = document.querySelector(`#matches-${g} tbody`);
    table.innerHTML=""; matches.innerHTML="";

    sorted.forEach(d=>{
      const clickable = isMaster ?
        `<td class="team-editable" onclick="inlineRename('${g}','${d.name}')">
           ${d.name} 
           <button style="margin-left:4px;" onclick="deleteTeamInline('${g}','${d.name}');event.stopPropagation();">Ø­Ø°Ù</button>
         </td>` :
        `<td>${d.name}</td>`;

      table.innerHTML += `<tr>
        ${clickable}
        <td>${d.p}</td><td>${d.w}</td><td>${d.d}</td><td>${d.l}</td>
        <td>${d.gf}</td><td>${d.ga}</td><td>${d.gd}</td><td>${d.pts}</td>
      </tr>`;
    });

    for(const k in data){
      const m = data[k];
      const editDel = isMaster?`
        <td><button onclick="editMatch('${g}','${k}')">ØªØ¹Ø¯ÙŠÙ„</button></td>
        <td><button onclick="delMatch('${g}','${k}')">Ø­Ø°Ù</button></td>`:"";

      matches.innerHTML += `<tr>
        <td>${m.t1}</td><td>${m.s1}</td>
        <td>${m.t2}</td><td>${m.s2}</td>
        ${editDel}
      </tr>`;
    }
  });
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡Ø¯Ø§ÙÙŠÙ†
function updateScorerForm(){
  if(!isMaster) return;
  actionsHeader.innerHTML = "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª";
  addScorerDiv.innerHTML = `
    <input type="text" id="scorerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">
    <select id="scorerTeam"></select>
    <input type="number" id="scorerGoals" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù" min="1">
    <button onclick="addScorer()">Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ø§Ù</button>
  `;
  const sel = document.getElementById("scorerTeam");
  sel.innerHTML="";
  for(const g of ["A","B","E","F"]){
    groups[g].forEach(t=>sel.add(new Option(t,t)));
  }
}

window.addScorer = function(){
  const name = document.getElementById("scorerName").value.trim();
  const team = document.getElementById("scorerTeam").value;
  const goals = parseInt(document.getElementById("scorerGoals").value)||0;
  if(!name || !team || goals<=0) return alert("Ø§Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
  push(ref(db,"scorers"),{name,team,goals});
  document.getElementById("scorerName").value="";
  document.getElementById("scorerGoals").value="";
}

// ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ù‡Ø¯Ø§ÙÙŠÙ†
window.editScorer = async function(key){
  if(!isMaster) return;
  const snap = await get(ref(db,"scorers/"+key));
  if(!snap.exists()) return alert("Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø¯Ø§Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");

  const data = snap.val();
  const name = prompt("Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨:", data.name);
  if(!name) return;
  const goals = prompt("Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:", data.goals);
  if(goals===null) return;
  const team = prompt("Ø§Ù„ÙØ±ÙŠÙ‚:", data.team);
  if(!team) return;

  await set(ref(db,"scorers/"+key), {name, team, goals:parseInt(goals)||0});
}

window.delScorer = function(key){
  if(!isMaster) return;
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø¯Ø§ÙØŸ")) remove(ref(db,"scorers/"+key));
}

// Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù‡Ø¯Ø§ÙÙŠÙ† ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©
onValue(ref(db,"scorers"), snap=>{
  const data = snap.val() || {};
  const tbody = document.querySelector("#scorersTable tbody");
  tbody.innerHTML="";
  const list=[];
  for(const k in data) list.push({...data[k], key:k});
  list.sort((a,b)=>b.goals-a.goals).forEach(d=>{
    const actions = isMaster?`
      <td>
        <button onclick="editScorer('${d.key}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button onclick="delScorer('${d.key}')">Ø­Ø°Ù</button>
      </td>`:"";
    tbody.innerHTML+=`<tr>
      <td>${d.name}</td><td>${d.team}</td><td>${d.goals}</td>
      ${actions}
    </tr>`;
  });
});

if(isMaster) updateScorerForm();
</script>
</body>
</html>